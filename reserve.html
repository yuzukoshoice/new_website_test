<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>【自分書斎 池袋】 - ご予約</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&family=Noto+Sans+JP:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', 'Noto Sans JP', sans-serif;
        }
        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 8px;
        }
        .day {
            padding: 12px 8px;
            text-align: center;
            border-radius: 8px;
            transition: background-color 0.3s, transform 0.2s;
        }
        .day-name {
            font-weight: bold;
            color: #4a5568; /* gray-700 */
        }
        .other-month {
            color: #a0aec0; /* gray-500 */
        }
        .available {
            background-color: #ebf8ff; /* blue-100 */
            cursor: pointer;
        }
        .available:hover {
            background-color: #bee3f8; /* blue-200 */
            transform: scale(1.05);
        }
        .full {
            background-color: #fed7d7; /* red-200 */
            color: #c53030; /* red-700 */
            cursor: not-allowed;
            text-decoration: line-through;
        }
        .past {
            background-color: #f7fafc; /* gray-100 */
            color: #a0aec0; /* gray-500 */
            cursor: not-allowed;
        }
    </style>
</head>
<body class="bg-gray-100">

    <!-- ヘッダー -->
    <header class="bg-white shadow-md">
        <div class="container mx-auto px-6 py-4 flex justify-between items-center">
            <a href="index.html" class="text-2xl font-bold text-gray-900">自分書斎</a>
            <a href="index.html" class="text-blue-600 hover:underline">トップページに戻る</a>
        </div>
    </header>

    <main class="container mx-auto p-6 md:p-12">
        
        <!-- Calendar Section -->
        <section id="calendar-section">
            <div class="bg-white p-6 md:p-8 rounded-xl shadow-lg">
                <h1 class="text-2xl md:text-3xl font-bold text-center mb-6">座席のご予約</h1>
                
                <!-- Calendar Controls -->
                <div class="flex justify-between items-center mb-6">
                    <button id="prev-month" class="p-2 rounded-full hover:bg-gray-200">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path></svg>
                    </button>
                    <h2 id="month-year" class="text-xl font-bold"></h2>
                    <button id="next-month" class="p-2 rounded-full hover:bg-gray-200">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path></svg>
                    </button>
                </div>
                
                <!-- Calendar Grid -->
                <div class="calendar-grid mb-4">
                    <div class="day-name">日</div>
                    <div class="day-name">月</div>
                    <div class="day-name">火</div>
                    <div class="day-name">水</div>
                    <div class="day-name">木</div>
                    <div class="day-name">金</div>
                    <div class="day-name">土</div>
                </div>
                <div id="calendar-days" class="calendar-grid">
                    <!-- Days will be generated by JavaScript -->
                </div>
            </div>
        </section>

        <!-- Booking Form Section (Initially hidden) -->
        <section id="booking-section" class="hidden">
            <div class="bg-white p-6 md:p-8 rounded-xl shadow-lg max-w-lg mx-auto">
                <div class="flex justify-between items-center mb-6">
                     <h2 id="booking-date-title" class="text-2xl font-bold"></h2>
                     <button id="back-to-calendar" class="text-sm text-blue-600 hover:underline">カレンダーに戻る</button>
                </div>
               
                <form id="booking-form">
                    <div class="space-y-6">
                        <div>
                            <label for="name" class="block text-sm font-medium text-gray-700">予約者名</label>
                            <input type="text" id="name" name="name" required class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                        </div>
                        <div>
                            <label for="email" class="block text-sm font-medium text-gray-700">メールアドレス</label>
                            <input type="email" id="email" name="email" required class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                        </div>
                        <div>
                            <label for="member-id" class="block text-sm font-medium text-gray-700">会員番号 (月額・回数券会員の方)</label>
                            <input type="text" id="member-id" name="member-id" placeholder="会員証に記載の番号" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                        </div>
                    </div>
                    <div class="mt-8">
                        <button type="submit" class="w-full bg-blue-600 text-white font-bold py-3 px-4 rounded-lg hover:bg-blue-700 transition duration-300">この内容で予約を確定する</button>
                    </div>
                </form>
            </div>
        </section>

        <!-- Success Message (Initially hidden) -->
         <div id="success-message" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center">
            <div class="bg-white p-8 rounded-xl shadow-lg text-center">
                <h2 class="text-2xl font-bold mb-4">ご予約完了</h2>
                <p class="text-gray-600 mb-6">ご予約ありがとうございます。<br>詳細はご入力いただいたメールアドレスにお送りしました。</p>
                <button id="close-success" class="bg-blue-600 text-white font-bold py-2 px-6 rounded-lg hover:bg-blue-700 transition duration-300">閉じる</button>
            </div>
        </div>

    </main>

    <script>
    document.addEventListener('DOMContentLoaded', () => {
        const calendarSection = document.getElementById('calendar-section');
        const bookingSection = document.getElementById('booking-section');
        const monthYearEl = document.getElementById('month-year');
        const calendarDaysEl = document.getElementById('calendar-days');
        const prevMonthBtn = document.getElementById('prev-month');
        const nextMonthBtn = document.getElementById('next-month');
        const backToCalendarBtn = document.getElementById('back-to-calendar');
        const bookingForm = document.getElementById('booking-form');
        const bookingDateTitle = document.getElementById('booking-date-title');
        const successMessage = document.getElementById('success-message');
        const closeSuccessBtn = document.getElementById('close-success');

        let currentDate = new Date();
        const TOTAL_SEATS = 20; // 総座席数

        // --- Mock Data for Bookings ---
        // In a real application, this would come from a server/database.
        // Key: 'YYYY-MM-DD', Value: number of seats booked
        const bookings = {
            // Some mock data for the current month
            [new Date().toISOString().slice(0, 8) + '15']: 18,
            [new Date().toISOString().slice(0, 8) + '20']: 20, // Full
            [new Date().toISOString().slice(0, 8) + '25']: 5,
        };
        
        function renderCalendar() {
            calendarDaysEl.innerHTML = '';
            const year = currentDate.getFullYear();
            const month = currentDate.getMonth();

            monthYearEl.textContent = `${year}年 ${month + 1}月`;
            
            const firstDayOfMonth = new Date(year, month, 1);
            const lastDayOfMonth = new Date(year, month + 1, 0);
            
            const startDayOfWeek = firstDayOfMonth.getDay();
            const daysInMonth = lastDayOfMonth.getDate();

            const today = new Date();
            today.setHours(0, 0, 0, 0);

            // Add blank days for the start of the month
            for (let i = 0; i < startDayOfWeek; i++) {
                const dayEl = document.createElement('div');
                dayEl.classList.add('day');
                calendarDaysEl.appendChild(dayEl);
            }

            // Add days of the month
            for (let i = 1; i <= daysInMonth; i++) {
                const dayEl = document.createElement('div');
                dayEl.classList.add('day');
                
                const date = new Date(year, month, i);
                const dateString = `${year}-${String(month + 1).padStart(2, '0')}-${String(i).padStart(2, '0')}`;
                
                const bookedSeats = bookings[dateString] || 0;
                const availableSeats = TOTAL_SEATS - bookedSeats;

                dayEl.innerHTML = `<span>${i}</span>`;
                dayEl.dataset.date = dateString;

                if (date < today) {
                    dayEl.classList.add('past');
                    dayEl.innerHTML += `<span class="block text-xs">終了</span>`;
                } else if (availableSeats <= 0) {
                    dayEl.classList.add('full');
                    dayEl.innerHTML += `<span class="block text-xs">満席</span>`;
                } else {
                    dayEl.classList.add('available');
                    dayEl.innerHTML += `<span class="block text-xs text-blue-600 font-bold">空き ${availableSeats}</span>`;
                    dayEl.addEventListener('click', () => showBookingForm(dateString));
                }

                calendarDaysEl.appendChild(dayEl);
            }
        }
        
        function showBookingForm(dateString) {
            const [year, month, day] = dateString.split('-');
            bookingDateTitle.textContent = `${month}月${day}日のご予約`;
            bookingForm.dataset.bookingDate = dateString;
            calendarSection.classList.add('hidden');
            bookingSection.classList.remove('hidden');
        }

        function showCalendar() {
            bookingSection.classList.add('hidden');
            calendarSection.classList.remove('hidden');
            bookingForm.reset();
        }

        prevMonthBtn.addEventListener('click', () => {
            currentDate.setMonth(currentDate.getMonth() - 1);
            renderCalendar();
        });

        nextMonthBtn.addEventListener('click', () => {
            currentDate.setMonth(currentDate.getMonth() + 1);
            renderCalendar();
        });
        
        backToCalendarBtn.addEventListener('click', showCalendar);

        bookingForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const name = document.getElementById('name').value;
            const email = document.getElementById('email').value;
            const memberId = document.getElementById('member-id').value;
            const bookingDate = e.target.dataset.bookingDate;

            console.log('Booking submitted:', { name, email, memberId, bookingDate });
            
            // In a real app, you would send this to a server.
            // For now, we just simulate success.
            bookings[bookingDate] = (bookings[bookingDate] || 0) + 1;

            successMessage.classList.remove('hidden');
        });

        closeSuccessBtn.addEventListener('click', () => {
            successMessage.classList.add('hidden');
            showCalendar();
            renderCalendar(); // Re-render to show updated availability
        });

        renderCalendar();
    });
    </script>

</body>
</html>
